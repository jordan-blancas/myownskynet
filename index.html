<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <!-- PWA-friendly viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>MyOwnSkynet ‚Äî Runner</title>

  <!-- PWA & mobile -->
  <meta name="theme-color" content="#0b1020">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png" type="image/png">

  <link rel="stylesheet" href="style.css" />

  <style>
    /* force body/canvas to behave nicely on mobile */
    html,body {
      height:100%;
      margin:0;
      padding:0;
      background:linear-gradient(180deg,#0b1020,#071018);
    }
    main { 
      width:100%; 
      max-width:1100px; 
      margin:0 auto; 
      display:flex; 
      gap:18px; 
      align-items:flex-start; 
      padding:12px; 
      box-sizing:border-box; 
    }
    
    canvas { 
      background:#edf2f7; 
      border-radius:6px; 
      display:block; 
      width:100%; 
      height:auto; 
      max-height:60vh; 
      flex: 1;
    }
    
    .help {
      flex: 0 0 250px;
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.4;
    }
    
    /* Botones principales del juego */
    .game-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 1001;
    }
    
    .game-btn {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .game-btn.start { background: #27ae60; color: white; }
    .game-btn.pause { background: #f39c12; color: white; }
    .game-btn.resume { background: #3498db; color: white; }
    .game-btn.stop { background: #e74c3c; color: white; }
    
    .game-btn:hover { transform: scale(1.05); }
    .game-btn:active { transform: scale(0.95); }
    
    /* Controles retr√°ctiles */
    .controls-panel {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      border-radius: 15px;
      padding: 10px;
      z-index: 1000;
      transition: all 0.3s ease;
      max-height: 300px;
      overflow: hidden;
    }
    
    .controls-panel.collapsed {
      max-height: 50px;
    }
    
    .control-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .toggle-btn {
      background: none;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .controls-panel.collapsed .toggle-btn {
      transform: rotate(180deg);
    }
    
    .control-content {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .control-row {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    
    #controls button {
      width: 50px;
      height: 50px;
      font-size: 1.5rem;
      border-radius: 50%;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      transition: all 0.2s ease;
    }
    
    #controls button:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.1);
    }
    
    #controls button:active {
      background: rgba(88, 214, 141, 0.8);
      transform: scale(0.95);
    }
    
    .hidden {
      display: none !important;
    }
    
    @media (max-width:720px){
      main{flex-direction:column; padding:8px;}
      canvas{max-height:60vh;}
      .panel{width:100%}
      .help { flex: none; width: 100%; }
    }
    /* keep the rest of your style.css rules */
  </style>
</head>
<body>
  <header class="topbar">
    <h1>MyOwnSkynet</h1>
    <div class="hud">
      <div>Score: <span id="score">0</span></div>
      <div>Cred.: <span id="credits">0</span></div>
      <button id="upgradeBtn">Mejoras</button>
      <button id="resetBtn" title="Resetear progreso">Reset</button>
    </div>
  </header>

  <main>
    <!-- Canvas: el id se mantiene como "game" para compatibilidad con game.js -->
    <canvas id="game" width="900" height="400"></canvas>

    <!-- Botones principales del juego -->
    <div id="gameControls" class="game-controls">
      <button id="btnStart" class="game-btn start">‚ñ∂Ô∏è Iniciar</button>
      <button id="btnPause" class="game-btn pause hidden">‚è∏Ô∏è Pausar</button>
      <button id="btnResume" class="game-btn resume hidden">‚ñ∂Ô∏è Continuar</button>
      <button id="btnStop" class="game-btn stop hidden">‚èπÔ∏è Parar</button>
    </div>

    <!-- Controles de movimiento (retr√°ctiles) -->
    <div id="controls" class="controls-panel">
      <div class="control-header">
        <span>üéÆ Controles</span>
        <button id="btnToggleControls" class="toggle-btn">‚¨ÜÔ∏è</button>
      </div>
      <div class="control-content">
        <div class="control-row">
          <button id="btnUp">‚¨Ü</button>
        </div>
        <div class="control-row">
          <button id="btnLeft">‚¨Ö</button>
          <button id="btnShoot">üî•</button>
          <button id="btnRight">‚û°</button>
        </div>
        <div class="control-row">
          <button id="btnDown">‚¨á</button>
        </div>
        <div class="control-row">
          <button id="btnRestart" title="Reiniciar partida">üîÑ</button>
        </div>
      </div>
    </div>


    <aside id="panelUpgrade" class="panel hidden">
      <h2>Mejoras</h2>
      <div class="upgrade-list">
        <div class="upgrade" data-id="speed">
          <div class="u-title">Velocidad base</div>
          <div>+10% por nivel</div>
          <div>Coste: <span class="cost">10</span></div>
          <button class="buy">Comprar</button>
        </div>

        <div class="upgrade" data-id="jump">
          <div class="u-title">Fuerza salto</div>
          <div>+12% por nivel</div>
          <div>Coste: <span class="cost">12</span></div>
          <button class="buy">Comprar</button>
        </div>

        <div class="upgrade" data-id="shield">
          <div class="u-title">Escudo (temp)</div>
          <div>Protege de 1 impacto</div>
          <div>Coste: <span class="cost">25</span></div>
          <button class="buy">Comprar</button>
        </div>

        <div class="upgrade" data-id="mult">
          <div class="u-title">Multiplicador de cr√©ditos</div>
          <div>+0.1x por nivel</div>
          <div>Coste: <span class="cost">20</span></div>
          <button class="buy">Comprar</button>
        </div>
      </div>
      <button id="closePanel">Cerrar</button>
    </aside>

    <section class="help">
      <p>Controles: <strong>Tocar / clic (lado derecho)</strong> para disparar, <strong>espacio</strong> o tocar izquierda para saltar. Doble salto desbloqueable. Gana cr√©ditos al eliminar humanos o por distancia.</p>
      <p>M√°s adelante puedes exportar a Unity WebGL e integrar aqu√≠ en /unity-build o cargarlo en un iframe.</p>
    </section>
  </main>

  <footer class="ft">
    Creado por: Jordan Blancas.
  </footer>

  <script src="game.js?v=6"></script>
  <script src="debug.js"></script>

  <script>
    // Registrar Service Worker para PWA; el archivo service-worker.js DEBE estar en la ra√≠z.
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('‚úÖ Service Worker registrado'))
        .catch(err => console.error('‚ùå SW fallo:', err));
    }
  </script>
</body>
</html>
